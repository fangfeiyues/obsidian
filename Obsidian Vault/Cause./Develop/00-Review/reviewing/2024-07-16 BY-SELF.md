
###  P1

-  **2020.8-2023.3  有赞社电-云分销**

	[背景] 随着分销市场玩法的不断成熟，一级分销逐渐难以满足日益复杂的多层级裂变和批发模式
	[需求] 从 0 到 1 搭建包括上下级关系、多层分佣、数据统计、推广奖励等在内的多层级分销系统
	[难点] 
	1. 分布式锁+状态机推进状态流转来保证订单创建、支付、取消等的最终一致性，解决“不分佣”的问题
	2. 用multiversion思想，构建多版本视图，保证节点变更前后的可回溯性，解决“佣金该分给谁”的问题
	3. 用DDD战略设计，构建清晰的模型边界和内聚的分层架构，解耦领域间上下文关系，避免“大煤球”开发
	[结果] 补齐多级分销的业务场景，并在次年就带来了1500w+收益；同时通过良好的架构设计支持了业务的扩张与稳定


-  **话题思路（这也没什么复杂度~）**

	1.  场景：分销就是 「建立分销关系 -> 然后推广商品 -> 完成下单 -> 获取佣金 -> 形成奖励」
	2.  挑战（场景下的挑战）
		1.  分布式一致性：关系绑定、订单锁+状态机、等保证最终一致性
		2.  高并发：数据更新、DB锁？分布式锁？限流？
		3.  领域设计：上下文边界、分层理念、依赖倒置设计 （“开放”来切入）
	3.  业务（场景下的困点）
		1.  分销员客群
		2.  云分销客群

-  **Q & A**

	Q：为什么要做领域设计？
	A：避免大煤球式的设计，希望对外别的边界更清晰、对内部的分层更稳定
	
	Q：上下文边界该怎么划分？有什么方法论
	A：清晰定义业务职责，严格规则出入参。 `比如订单结算能力，就应该只关注「在什么时候谁给谁多少钱」的问题，而不应该在结算前后去关注分佣的状态或资金的统计
	
	Q：领域层该怎么保证稳定？
	A：区分哪些是场景，哪些是业务对象，尤其应用层和领域层，一定要保证后者的稳定，抛弃一切场景相关的编码。`比如上层的业务参数校验订单去校验用户信息、底层依赖的一定考虑依赖倒置等`
	
	
	Q：怎么看待分布式一致性问题？
	A：理解分布式，一个系统分成多个独立的组件，在组件之间调用传递信息时候出现一些失败延迟，为了保证最终的数据/业务的一致性，我们可以选择强一直或最终一致等
	
	Q：分布式锁 + 状态机推进最终分佣一致性怎么理解？（升华一下~）
	A：抽象出一套节点编排流程，通过分布式锁 + 节点重编排 -> 最终的一致性，有点类似于TCC
	
	
	Q：版本快照是怎么实现？会有什么问题？怎么解决
	A：A-B之间添加版本号version，再根据version区间取数；`核心在于，1. 版本数据与业务数据的一致性保证；2. 沉淀通用化方案`
	

### P2

-  **2023.3-至今  增值业务**
  
	[背景] 为提升公司收入和毛利，2023开始发力包括上门取件、有赞寄件、退货包运费等为代表的增值项目
	[需求] 在当前物流能力的基础上探索物流增值场景，并进一步提升履约增值takerate
	[难点] 
	1. 物流增值：通过与物流中台划分清晰的边界，搭建正逆向寄件的物流商运营与运费定价能力
	2. 履约增值：通过保单、投保、理赔等领域建设，解决退货包运费核心归因问题，并抽象复用保险核心
	[结果] 在复杂的物流中台下构建清晰的增值场景，并进一步扩展增值履约能力，收入上大幅提升50%+


-  **话题思路（怎么扩展~）**

	1.  场景
		1.  物流增值：在订单发货的基础上，寻找增值的可能
		2.  履约增值：在交易售后的基础上，寻找增值的方式
		   
	2.  挑战：控制风险的同时，下探渗透率和毛利率


-  **Q & A**

	Q：包运费的核心模型是什么？
	A：保单：承接外部的一些包运费行为，如交易订单
	 - 补贴：归因、计费
	 - 理赔：触发底层保险核心，去理赔（投保单、理赔单之类）
	   
	Q：有赞寄件的核心模型是什么？
	A：在物流能力的基础上，运营一些物流商管理、运费、结算等


###  P3

-  **2021.8-2022.4  有赞社电-分销员稳定性**

	[背景] 分销员是有赞商城TOP3插件，其稳定性不言而喻，但经过6年+的发展内部系统千疮百孔，急需治理
	[需求] 根解线上的高频资损问题、缓解每周50+线上jira、规避高流量下系统的不稳定性、合理规划架构演变
	[难点] 
	1. 高流量治理：分布式限流 + Redis有序集合，自动隔离窗口期的高流量消息到vip通道避免影响正常业务
	2. 性能优化：通过优化SQL索引慢询、Hot Key高频更新、CPU飙升等问题解决数据库和机器压力
	3. 资损防控：治理因分布式导致的最终不一致问题，并严格要求离线对账、实时监测等防控措施
	[结果] 潜在资损问题修复80%以上、每周线上问题下降30%、线上错误日志及告警下降50%以上，保障业务平稳发展




