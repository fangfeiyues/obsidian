## 类加载

加载 - 验证 - 准备 - 解析 - 初始化 - 使用 - 卸载

在初始化阶段有且只有六种情况必须立即对类进行初始化的：

1. 遇到new, getstatic, putstatic和invokestatic这四条字节码指令
    1. new实例化对象
    2. 读取或设置一个类型的静态字段
    3. 调用一个类型的静态方法
2. 使用java.lang.reflect包的反射调用
3. 初始化类的时候发现父类没有进行初始化
4. 虚拟机启动指定执行的main()方法主类
5. 动态语言支持...


![[image-类加载机制-20240425004106023.png|500]]



## 双亲委派

### 作用

1. 一个类在同一个加载器中具有唯一性。避免被篡改
2. 避免重复加载提升性能

### SPI打破双亲委派

1. 第一次破坏：双亲模型还没引入
2. 第二次破坏：没有办法解决用户基础类又要调用用户类的代码。为了解决这个问题有了线程上下文加载器如JNDI, JDBC等 。如 DriverManager 位于rt.jar包下由BootStrap类加载器加载，而Driver接口是位于服务商提供的Jar包下。根据类加载机制当被类加载的类引用了另一个类的时候，虚拟机就会使用转载第一个类的加载器转载被引用的类。但其只负责rt.jar所以需要子类加载器（线程上下文加载器AppClassLoader）去加载这就破坏了双亲加载模式
3. 第三次破坏：代码热替换，模块热部署。在更新一个模块的时